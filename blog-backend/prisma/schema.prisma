// blog-backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}


// ===========================================
// KULLANICI VE YETKİLENDİRME MODELLERİ
// ===========================================

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  address   String?
  role      String   @default("user") // "user" veya "admin"

  // --- İlişkiler ---
  posts         Post[]
  notifications Notification[]
  cartItems     CartItem[]
  orders        Order[]
  
  // Canlı Destek İlişkileri (Hata düzeltmesi)
  chatRooms     ChatRoom[]
  chatMessages  ChatMessage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


// ===========================================
// SİTE GENEL AYARLARI (SEO, TEMA, MODLAR)
// ===========================================

model SiteSettings {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  
  // --- Genel Ayarlar ---
  siteName     String   @default("Benim Sitem")
  logoUrl      String?
  footerText   String   @default("© 2025 Tüm hakları saklıdır.")
  homeLayout   String   @default("grid")
  showHomeSlider Boolean @default(true) // YENİ: Anasayfa slider aktif/pasif
  // --- Dil Ayarı ---
  enableEnglish   Boolean  @default(false) // false = Sadece TR, true = TR ve EN aktif

  // --- Düzen Ayarları ---
  navLayout       String   @default("top") // "top" (Üstte) veya "left" (Solda)
  navLinksJson    String?  // Üst menü linkleri (JSON)
  footerLinksJson String?  // Footer linkleri (JSON - örn: Gizlilik)

  // --- E-Ticaret Modu Ayarları ---
  eCommerceEnabled      Boolean @default(true) // true = Sepet, false = WhatsApp
  whatsAppNumber        String?
  whatsAppMessageTemplate String? @default("Merhaba, [ÜRÜN_ADI] ürünü hakkında bilgi almak istiyorum.")

  // 1. Kapıda Ödeme
  paymentCashEnabled Boolean @default(true)

  // 2. Havale / EFT
  paymentIbanEnabled Boolean @default(true)
  paymentIbanInfo    String?  // IBAN, Banka Adı vb. açıklamalar

  // 3. Kredi Kartı (e-POS / Iyzico vb.)
  paymentPosEnabled    Boolean @default(false)
  paymentPosApiKey     String? // API Key
  paymentPosSecretKey  String? // Secret Key
  paymentPosBaseUrl    String? // Örn: https://sandbox-api.iyzipay.com

  // --- TEMA RENK AYARLARI (Sarı & Siyah Tema) ---
  colorBackground String   @default("#000000")
  colorText       String   @default("#FFFFFF")
  colorPrimary    String   @default("#FFD700")
  colorSecondary  String   @default("#343a40")
  colorButtonAddToCart     String   @default("#FFD700")
  colorButtonAddToCartText String   @default("#000000")
  colorButtonBuyNow        String   @default("#FFFFFF")
  colorButtonBuyNowText    String   @default("#000000")
  colorCardBackground      String   @default("#343a40") // Varsayılan: Koyu Gri
  colorCardText            String   @default("#FFFFFF") // Varsayılan: Beyaz

  // --- Global SEO Ayarları ---
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String?
  seoAuthor       String?
}

// Anasayfa Slider görselleri (Çoklu Dil)
model SliderImage {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  imageUrl    String
  caption_tr  String?  // TR Başlık
  caption_en  String?  // EN Başlık
  linkUrl     String?
  order       Int      @default(0)
}


// ===========================================
// BLOG İÇERİK MODELLERİ (Çoklu Dil)
// ===========================================

// Blog Ana Kategorileri
model Category {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  name_tr       String        @unique // TR Kategori Adı
  name_en       String?       // EN Kategori Adı
  subcategories SubCategory[]
  posts         Post[]
}

// Blog Alt Kategorileri
model SubCategory {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name_tr    String   // TR Alt Kategori Adı
  name_en    String?  // EN Alt Kategori Adı
  categoryId String   @db.ObjectId
  category   Category @relation(fields: [categoryId], references: [id])
  posts      Post[]
  
  @@unique([name_tr, categoryId])
}

// Blog Yazıları
model Post {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  
  // --- Çoklu Dil Alanları ---
  title_tr      String
  title_en      String?
  content_tr    String
  content_en    String?
  excerpt_tr    String?
  excerpt_en    String?
  // --- Bitiş ---

  featuredImage String?
  
  authorId      String       @db.ObjectId
  author        User         @relation(fields: [authorId], references: [id])

  categoryId    String?      @db.ObjectId
  category      Category?    @relation(fields: [categoryId], references: [id])
  subCategoryId String?      @db.ObjectId
  subCategory   SubCategory? @relation(fields: [subCategoryId], references: [id])

  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}


// ===========================================
// ÜRÜN GALERİ MODELLERİ (Çoklu Dil)
// ===========================================

// Ürün Ana Kategorisi
model ProductCategory {
  id               String               @id @default(auto()) @map("_id") @db.ObjectId
  name_tr          String               @unique
  name_en          String?
  description_tr   String?
  description_en   String?
  subCategories    ProductSubCategory[] 
}

// Ürün Alt Kategorisi
model ProductSubCategory {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  name_tr          String
  name_en          String?
  description_tr   String?
  description_en   String?
  
  categoryId       String          @db.ObjectId
  category         ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  products         Product[]
  
  @@unique([name_tr, categoryId]) 
}

// Ürün Modeli
model Product {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  
  // --- Çoklu Dil Alanları ---
  name_tr             String
  name_en             String?
  description_tr      String
  description_en      String?
  shortDescription_tr String?
  shortDescription_en String?
  // --- Bitiş ---

  // --- Fiyat ve Kampanya Alanları ---
  price            Float     // Nihai (indirimli) fiyat
  originalPrice    Float?    // Üstü çizili (indirim öncesi) fiyat
  discountLabel    String?   // "%10 İndirim" etiketi
  
  sku              String?   @unique
  stock            Int       @default(0)
  status           String    @default("draft")

  // --- İlişkiler ---
  subCategoryId String?             @db.ObjectId
  subCategory   ProductSubCategory? @relation(fields: [subCategoryId], references: [id])
  galleryImages    ProductImage[]
  cartItems        CartItem[]

  features ProductFeature[]
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  // Kampanya İlişkisi
  campaignIDs String[]   @db.ObjectId
  campaigns   Campaign[] @relation(fields: [campaignIDs], references: [id])
}

// Ürün Galerisi Görselleri
model ProductImage {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  imageUrl  String
  altText   String?  // SEO için (Bunu tek dil tuttuk)
  order     Int      @default(0)
  
  productId String   @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}


// ===========================================
// E-TİCARET MODELLERİ (SEPET VE SİPARİŞ)
// ===========================================

model CartItem {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId String   @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  
  @@unique([userId, productId])
}

model Order {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id])
  items         OrderItem[]
  totalAmount   Float
  status        String   @default("pending")
  paymentMethod String   
  paymentStatus String   @default("unpaid")
  shippingAddress String
  customerName    String
  customerPhone   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model OrderItem {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId   String   @db.ObjectId
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  // Anlık Görüntü (Snapshot)
  productId       String
  productName     String   // Sipariş anındaki ürün adı (Çoklu dilden hangisi seçildiyse)
  priceAtPurchase Float
  quantity        Int
}


// ===========================================
// YÖNETİM VE İLETİŞİM MODELLERİ
// ===========================================

// İletişim Formu (Kullanıcıdan geldiği için tek dil)
model ContactSubmission {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  firstName String
  lastName  String
  email     String
  phone     String?
  address   String?
  subject   String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// Bildirimler (Sistem tarafından oluşturulduğu için tek dil)
model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  message   String
  isRead    Boolean  @default(false)
  link      String?
  type      String?
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// Dinamik Sayfalar (Hakkımızda vb. - Çoklu Dil)
model DynamicPage {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title_tr  String
  title_en  String?
  slug      String   @unique // (örn: "hakkimizda")
  
  // Esnek içerik blokları (JSON formatında)
  layoutJson_tr String?
  layoutJson_en String?
  // --- YENİ ALANLAR ---
  sliderEnabled  Boolean  @default(true) // Slider'ı aktif/deaktif et
  sliderPosition String   @default("top")  // "top" (içeriğin üstü) veya "bottom" (içeriğin altı)
  // --- YENİ ALANLAR: Slider boyutu ve Responsive ayarları ---
  sliderHeightPx_mobile Int? @default(200) // Mobil cihazlarda slider yüksekliği (px)
  sliderHeightPx_desktop Int? @default(400) // Masaüstü cihazlarda slider yüksekliği (px)
  sliderObjectFit String   @default("cover") // Resmin nasıl sığdırılacağı: 'cover' veya 'contain'
  // --- YENİ ALANLAR SONU ---
  
  
  sliderImages DynamicPageSliderImage[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Dinamik Sayfalara ait özel slider (Çoklu Dil)
model DynamicPageSliderImage {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  imageUrl   String
  caption_tr String?
  caption_en String?
  description_tr String?
  description_en String?
  order      Int      @default(0)
  pageId     String      @db.ObjectId
  page       DynamicPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
}


// ===========================================
// CANLI DESTEK SOHBET MODELLERİ
// ===========================================

model ChatRoom {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String     @db.ObjectId
  user      User       @relation(fields: [userId], references: [id])
  messages  ChatMessage[]
  status    String     @default("open")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@unique([userId, status])
}

model ChatMessage {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  roomId     String   @db.ObjectId
  room       ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  authorId   String   @db.ObjectId
  author     User     @relation(fields: [authorId], references: [id])
  authorRole String   // "user" veya "admin"
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
}
// 3. YENİ: Kampanya Modeli
model Campaign {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  title_tr       String
  title_en       String?
  slug           String   @unique  // URL (örn: /kampanya/yaz-firsatlari)
  description_tr String?
  description_en String?
  
  isActive       Boolean  @default(true) // Aktif/Deaktif durumu
  
  // İlişkili Ürünler
  productIDs     String[]  @db.ObjectId
  products       Product[] @relation(fields: [productIDs], references: [id])

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
model ProductFeature {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  
  // Özellik Adı (örn: Renk, Boyut)
  key_tr    String
  key_en    String?

  // Özellik Değeri (örn: Kırmızı, XL)
  value_tr  String
  value_en  String?

  productId String   @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}